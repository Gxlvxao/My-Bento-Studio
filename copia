'use client'

import { useLayoutEffect, useRef } from 'react'
import Image from 'next/image'
import gsap from 'gsap'
import { ScrollTrigger } from 'gsap/ScrollTrigger'
import { useBrandStore } from '@/store/brandStore'

if (typeof window !== "undefined") {
    gsap.registerPlugin(ScrollTrigger)
}

export default function BentoGrid() {
  const containerRef = useRef<HTMLDivElement>(null)
  
  // Conectando com a Store Global
  const { colors, content } = useBrandStore()
  
  useLayoutEffect(() => {
    const ctx = gsap.context(() => {
      const tl = gsap.timeline({ defaults: { ease: 'power3.out' } });

      tl.from('.header-layer', { y: -50, opacity: 0, duration: 1 })
      tl.from('.text-bg-layer', { opacity: 0, duration: 0.8 }, "-=0.8")
      tl.from('.text-content', { x: -30, opacity: 0, duration: 0.8 }, "-=0.6")
      tl.from('.main-image-layer', { y: 100, opacity: 0, duration: 1.2 }, "-=0.8")
      tl.from('.mini-square', { x: 50, opacity: 0, stagger: 0.1, duration: 0.6 }, "-=1")

    }, containerRef)

    return () => ctx.revert()
  }, [])

  return (
    <section 
        ref={containerRef} 
        className="w-full h-screen bg-white overflow-hidden relative font-sans transition-colors duration-500"
        // INJEÇÃO DINÂMICA DAS CORES DO CLIENTE AQUI
        style={{
            '--color-layout-pink': colors.pink,
            '--color-layout-green': colors.green,
            '--color-layout-blue': colors.blue,
        } as React.CSSProperties}
    >
      
      <div className="absolute top-0 left-0 w-full h-[10vh] z-20 header-layer bg-layout-pink flex items-center px-8 shadow-sm transition-colors duration-300">
           <h1 className="text-lg font-bold uppercase tracking-[0.2em] text-black/60">{content.headerTitle}</h1>
      </div>

      <div className="absolute top-[10vh] left-0 w-full h-[90vh] z-10 text-bg-layer">
          <div className="w-full h-full bg-layout-blue p-16 flex flex-col justify-center text-content transition-colors duration-300">
               <div className="max-w-[30vw]"> 
                  <div className="w-24 h-2 bg-black/10 rounded-full mb-6"></div>
                  <h2 className="text-[6rem] font-black text-black/80 tracking-tighter leading-[0.85] mb-6 whitespace-pre-wrap">
                    {content.textZoneTitle}
                  </h2>
                  <p className="text-black/60 text-xl font-medium leading-relaxed">
                    {content.textZoneBody}
                  </p>
               </div>
          </div>
      </div>

      <div className="absolute top-[13vh] right-[61vw] z-20 flex gap-3 h-[150px]">
          {[1, 2, 3, 4, 5].map((i) => (
            <div key={i} className="mini-square w-[150px] h-[150px] bg-layout-green rounded-[2.5rem] shadow-md border-[5px] border-white hover:scale-105 transition-transform duration-300 transition-colors"></div>
          ))}
      </div>

      <div className="absolute top-[5vh] right-0 bottom-0 w-[60vw] z-30 main-image-layer">
           <div className="w-full h-full bg-layout-green rounded-tl-[4rem] relative overflow-hidden shadow-2xl border-l-[10px] border-t-[10px] border-white group transition-colors duration-300">
                <Image 
                    src={content.mainImage}
                    alt="Main Visual"
                    fill
                    className="object-cover group-hover:scale-105 transition-transform duration-1000"
                />
                 <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                     <h2 className="text-[9rem] font-black text-white mix-blend-overlay">IMAGE</h2>
                 </div>
           </div>
      </div>

    </section>
  )
}